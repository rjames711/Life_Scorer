{% extends 'base.html' %}
{% block header %}
<!DOCTYPE html>
<html>

<head>
    <title>Page Title</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/hint/show-hint.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/mode/javascript/javascript.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/hint/show-hint.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/addon/hint/javascript-hint.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body style="background-color:grey">
    <div id="res"></div>
    <textarea id="editor"></textarea>
    <button onclick='run()'>run</button>
    <input id="script_name" placeholder="Script Name" value={{script_name}}>
    <button onclick="save_script()">save</button>
    <script type="text/javascript" language="javascript">
        var atest = 'hey Ima string';
        function run() {
            eval(myCodeMirror.getValue());
        }
        var myCodeMirror = CodeMirror.fromTextArea(document.getElementById('editor'), {
            mode: "javascript",
            value: "", //can't get this to work here.
            extraKeys: { "Ctrl-Space": "autocomplete" },
            lineNumbers: true
        });
        myCodeMirror.setValue({{ script | tojson }})

        function save_script(){
            console.log('Saving');
            let script = myCodeMirror.getValue()
            let name = document.getElementById('script_name').value
            $.ajax({
                type : 'POST',
                url : "{{url_for('save_script')}}",
                data : {'script_name':name, 'script':script},
                success: function(response){
                    //window.location.href = response.redirect;
                    window.location.href = "../custom/"+name
                }
              });

            }
    </script>
</body>

</html>

{% endblock %}